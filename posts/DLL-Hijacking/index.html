<!DOCTYPE html><html lang="en-US" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="DLL Hijacking Note" /><meta name="author" content="nonetype" /><meta property="og:locale" content="en_US" /><meta name="description" content="Note for DLL Hijacking" /><meta property="og:description" content="Note for DLL Hijacking" /><link rel="canonical" href="https://nonetype.kr/posts/DLL-Hijacking/" /><meta property="og:url" content="https://nonetype.kr/posts/DLL-Hijacking/" /><meta property="og:site_name" content="do:pwn()" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-02T14:41:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="DLL Hijacking Note" /><meta name="twitter:site" content="@nonetype_pwn" /><meta name="twitter:creator" content="@nonetype" /><meta name="google-site-verification" content="googlef894166fa16bb09c" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"nonetype"},"description":"Note for DLL Hijacking","url":"https://nonetype.kr/posts/DLL-Hijacking/","headline":"DLL Hijacking Note","dateModified":"2020-12-02T15:13:39+08:00","datePublished":"2020-12-02T14:41:00+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://nonetype.kr/posts/DLL-Hijacking/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>DLL Hijacking Note | do:pwn()</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="do:pwn()"><meta name="application-name" content="do:pwn()"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-HLXHMG7DE3"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-HLXHMG7DE3'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/me.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">do:pwn()</a></div><div class="site-subtitle font-italic">AttributeError - 'NoneType'</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/nonetype" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/nonetype_pwn" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['exploit','kakao.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>DLL Hijacking Note</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>DLL Hijacking Note</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> nonetype </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Dec 2, 2020, 2:41 PM +0800" prep="on" > Dec 2, 2020 <i class="unloaded">2020-12-02T14:41:00+08:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Dec 2, 2020, 4:13 PM +0900" prefix="Updated " > Dec 2, 2020 <i class="unloaded">2020-12-02T15:13:39+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="374 words">2 min</span></div></div><div class="post-content"><p>Note for DLL Hijacking</p><ul><li><a href="#the-path-check-order-for-loading-dll">The path check order for loading DLL</a><li><a href="#interesting-dlls">Interesting DLLs</a><ul><li><a href="#windows-10">Windows 10</a><ul><li><a href="#windowscoredeviceinfodll">WindowsCoreDeviceInfo.dll</a></ul><li><a href="#windows-7">Windows 7</a></ul><li><a href="#interesting-tools">Interesting tools</a><ul><li><a href="#siofra">Siofra</a></ul><li><a href="#helpful-articles">Helpful articles</a></ul><h1 id="the-path-check-order-for-loading-dll">The path check order for loading DLL</h1><ol><li>The directory from which the application loaded<li>32-bit System directory (C:\Windows\System32)<li>16-bit System directory (C:\Windows\System)<li>Windows directory (C:\Windows)<li>The current working directory (CWD)<li>Directories in the PATH environment variable (first system and then user)</ol><h1 id="interesting-dlls">Interesting DLLs</h1><h2 id="windows-10">Windows 10</h2><h3 id="windowscoredeviceinfodll">WindowsCoreDeviceInfo.dll</h3><p><strong>Status</strong></p><ul><li>Hijackable (Verified)</ul><p><strong>Full path</strong></p><ul><li>C:\Windows\System32\WindowsCoreDeviceInfo.dll</ul><p><strong>Loaded process</strong></p><ul><li>svchost.exe (SYSTEM perm)<li>usocoreworker.exe (SYSTEM perm)</ul><p><strong>References</strong></p><ul><li><a href="https://itm4n.github.io/usodllloader-part1/">https://itm4n.github.io/usodllloader-part1/</a></ul><h2 id="windows-7">Windows 7</h2><p>In Windows 7, I found some dlls which checked by some processes but not exist. (Just place your dll to the path)</p><p><strong>But not clear it’s hijackable dll</strong></p><ul><li>csrss.exe (SYSTEM perm)<ul><li>Note<ul><li>Only EN version Windows?</ul><li>Dlls<ul><li>C:\Windows\System32\en-US\Microsoft.Windows.Common-Controls.DLL<li>C:\Windows\System32\en\Microsoft.Windows.Common-Controls.DLL</ul></ul><li>powershell.exe (user perm)<ul><li>Dlls<ul><li>C:\Windows\System32\WindowsPowerShell\v.1.0\ATL.DLL<li>C:\Windows\System32\WindowsPowerShell\v.1.0\USERENV.dll</ul></ul><li>SearchProtocolHost.exe (SYSTEM perm)<ul><li>Note<ul><li>Checked twice every 6mins</ul><li>Dlls<ul><li>C:\Windows\System32\msfte.dll<li>C:\Windows\System32\msTracer.dll</ul></ul><li>svchost.exe (SYSTEM perm)<ul><li>Note<ul><li>Check interval is long or need some behavior</ul><li>Dlls<ul><li>C:\Users\user\AppData\Local\VirtualStore\Windows\System32\msxml3.dll<li>C:\Windows\SysWOW64\vga.dll<li>C:\Users\<Username>\\Appdata\\Local\\VirtualStore\\Windows\\SYSTEM32\\ntdll.dll </Username><ul><li>checked by Mpengine.dll</ul></ul></ul><li>winsat.exe (user perm)<ul><li>Dlls<ul><li>C:\Windows\System32\gdiplus.dll</ul></ul><li>wmiprvse.exe (SYSTEM perm)<ul><li>Note<ul><li>Check interval is long or need some behavior</ul><li>Dlls<ul><li>C:\Windows\System32\wbem\CRYBTBASE.dll<li>C:\Windows\System32\wbem\ntmarta.dll<li>C:\Windows\System32\wbem\CRYPTSP.dll<li>C:\Windows\System32\wbem\RpcRtRemote.dll</ul></ul><li>mscorsvw.exe (unknown perm)<ul><li>Note<ul><li>Check interval is long or need some behavior</ul><li>Dlls<ul><li>C:\Windows\SysWOW64\rpcss.dll</ul></ul></ul><h1 id="interesting-tools">Interesting tools</h1><h2 id="siofra">Siofra</h2><ul><li><a href="https://github.com/Cybereason/siofra">https://github.com/Cybereason/siofra</a></ul><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>Siofra is a tool designed to identify and exploit DLL hijacking vulnerabilities 
in Windows programs. It is able to simulate the Windows loader in order to give 
visibility into all of the dependencies (and corresponding vulnerabilities) of 
a PE on disk, or alternatively an image file in memory corresponding to an active 
process. More significantly, the tool has the ability to easily generate DLLs to 
exploit these types of vulnerabilities via PE infection with dynamic shellcode creation. 
These infected DLLs retain the code (DllMain, exported functions) as well as the 
resources of a DLL to seamlessly preserve the functionality of the application loading 
them, while at the same time allowing the researcher to specify an executable payload 
to be either run as a separate process or loaded into the target as a module. Additionally, 
the tool contains automated methods of combining UAC auto-elevation criteria with 
the aforementioned functionality in order to scan for UAC bypass vulnerabilities.
</pre></table></code></div></div><h1 id="helpful-articles">Helpful articles</h1><ul><li><a href="https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows">https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows</a><li><a href="https://itm4n.github.io/windows-dll-hijacking-clarified/">https://itm4n.github.io/windows-dll-hijacking-clarified/</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/pwn/'>pwn</a>, <a href='/categories/windows/'>windows</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dll-hijacking/" class="post-tag no-text-decoration" >dll hijacking</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=DLL Hijacking Note - do:pwn()&url=https://nonetype.kr/posts/DLL-Hijacking/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=DLL Hijacking Note - do:pwn()&u=https://nonetype.kr/posts/DLL-Hijacking/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=DLL Hijacking Note - do:pwn()&url=https://nonetype.kr/posts/DLL-Hijacking/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/DLL-Hijacking/">DLL Hijacking Note</a><li><a href="/posts/BlazeCTF2018-blazeme-write-up/">blazeme - BlazeCTF 2018</a><li><a href="/posts/Linux-Kernel-Exploit-Development-lab1/">Linux Kernel Exploit Development (Part 1/10)</a><li><a href="/posts/Linux-Kernel-Exploit-Development-lab2/">Linux Kernel Exploit Development (Part 2/10)</a><li><a href="/posts/Linux-Kernel-Exploit-Development-lab3/">Linux Kernel Exploit Development (Part 3/10)</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/exploit/">exploit</a> <a class="post-tag" href="/tags/debugging/">debugging</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/tips/">tips</a> <a class="post-tag" href="/tags/firefox/">firefox</a> <a class="post-tag" href="/tags/heap/">heap</a> <a class="post-tag" href="/tags/1-day/">1-day</a> <a class="post-tag" href="/tags/analysis/">analysis</a> <a class="post-tag" href="/tags/ctf/">ctf</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Linux-Kernel-Exploit-Development-lab1/"><div class="card-body"> <span class="timeago small" > Sep 23, 2019 <i class="unloaded">2019-09-23T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux Kernel Exploit Development (Part 1/10)</h3><div class="text-muted small"><p> Linux Kernel Exploit Development with VMware - Lab1::Debugging Environment 목차 목차 Debugging Environment Debugger Attach Debug Program Debugging Environment 우선 디버깅 환경을 살펴보니 MasterVM와...</p></div></div></a></div><div class="card"> <a href="/posts/Linux-Kernel-Exploit-Development-lab2/"><div class="card-body"> <span class="timeago small" > Sep 23, 2019 <i class="unloaded">2019-09-23T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux Kernel Exploit Development (Part 2/10)</h3><div class="text-muted small"><p> Linux Kernel Exploit Development with VMware - Lab2::Module Debugging 목차 목차 The Kernel Module Debugger Attach to Kernel Module Debug Kernel Module The Kernel Module TestVM의 mod_sam...</p></div></div></a></div><div class="card"> <a href="/posts/Linux-Kernel-Exploit-Development-lab3/"><div class="card-body"> <span class="timeago small" > Sep 23, 2019 <i class="unloaded">2019-09-23T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux Kernel Exploit Development (Part 3/10)</h3><div class="text-muted small"><p> Linux Kernel Exploit Development with VMware - Lab3::Privilege Escalation 목차 목차 Privilege Escalation do: LPE() do: LPE() - automated References Privilege Escalation 커널 권한 상승은 보통 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/CVE-2019-9791-Analysis/" class="btn btn-outline-primary" prompt="Older"><p>CVE-2019-9791 Analysis</p></a> <span class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></span></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/nonetype_pwn">Wonyoung Jung</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/kernel/">kernel</a> <a class="post-tag" href="/tags/exploit/">exploit</a> <a class="post-tag" href="/tags/debugging/">debugging</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/tips/">tips</a> <a class="post-tag" href="/tags/firefox/">firefox</a> <a class="post-tag" href="/tags/heap/">heap</a> <a class="post-tag" href="/tags/1-day/">1 day</a> <a class="post-tag" href="/tags/analysis/">analysis</a> <a class="post-tag" href="/tags/ctf/">ctf</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://nonetype.kr{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
